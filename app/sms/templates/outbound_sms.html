{% extends 'admin/base.html' %}

{% load static %}

{% block extrahead %}
    {{ block.super }}
    <script src="{% static 'admin/js/vendor/jquery/jquery.js' %}"></script>
    <script src="{% static 'admin/js/jquery.init.js' %}"></script>
{% endblock %}

{% block content %}
<div class="module">
    <table>
        <tr>
            <td>
                <label for="customers">Customers:</label>
                <select multiple="multiple" id="id_toppings" name="customers" class="select-multiple-field">
                    {% for customer in customers %}
                        {% if customer.id|stringformat:"s" in selected %}
                            <option value="{{ customer.id }}" selected>{{ customer.full_name }}</option>
                        {% else %}
                            <option value="{{ customer.id }}">{{ customer.full_name }}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            </td>
            <td>
                <label for="templates">Templates:</label>
                <select id="templates" name="template">
                    {% for template in templates %}
                        <option value="{{ template.id }}">{{ template }}</option>
                    {% endfor %}
                </select>
            </td>
        </tr>
    </table>
    <form id="select-zip-form" action="/sms/outbound-sms/" method="get">
        <select name="zip_code">
            <option value="">Select Zip Code</option>
            {% for zip in zips %}
                <option value="{{ zip }}">{{ zip }}</option>
            {% endfor %}
        </select>
        <input type="submit" value="Select">
    </form>
    
    <form id="select-city-form" action="/sms/outbound-sms/" method="get">
        <select name="city">
            <option value="">Select City</option>
            {% for city in cities %}
                <option value="{{ city }}">{{ city }}</option>
            {% endfor %}
        </select>
        <input type="submit" value="Select">
    </form>

    <form id="select-email-form" action="/sms/outbound-sms/" method="get">
    <select id="id_toppings" name="address" class="select-multiple-field">
        {% for customer in customers %}
        <option value="{{ customer.billing_address.address_line_1 }}">{{ customer.billing_address.address_line_1 }}</option>
        {% endfor %}
    </select>
    <input type="submit" value="Select">
    </form>
    
    <form id="select-phone-form" action="/sms/outbound-sms/" method="get">
    <select id="id_toppings" name="phone" class="select-multiple-field">
        {% for customer in customers %}
        <option value="{{ customer.main_phone.number }}">{{ customer.main_phone.number }}</option>
        {% endfor %}
    </select>
    <input type="submit" value="Select">
    </form>

    <form id="send-sms-form" action="{% url 'send_sms' %}" method="post">
      {% csrf_token %}
      <input type="hidden" id="selected-customers-input" name="customers">
      <input type="hidden" id="selected-template-input" name="template">
      <input type="submit" value="Submit">
  </form>
</div>

<script>
  var sendSmsForm = document.getElementById("send-sms-form");
  var selectedCustomersInput = document.getElementById("selected-customers-input");
  var selectedTemplateInput = document.getElementById("selected-template-input");

  sendSmsForm.addEventListener("submit", function (event) {
      event.preventDefault();

      var customers = Array.from(document.getElementById("id_toppings").options)
          .filter(option => option.selected)
          .map(option => option.value);
  
      var template = document.getElementById("templates").value;
  
      selectedCustomersInput.value = JSON.stringify(customers);
      selectedTemplateInput.value = template;
  
      sendSmsForm.submit();
  });
</script>


{% endblock %}
