{% extends 'admin/change_form.html' %} 

{% block extrahead %}
{{ block.super }}
<script>
  // JavaScript to show and hide the modal
  const openModalBtn = document.getElementById("openModalBtn");
  const closeModalBtn = document.getElementById("closeModalBtn");
  const modal = document.getElementById("myModal");

  function openModal() {
    modal.style.display = "block";
  }

  closeModalBtn.addEventListener("click", () => {
    modal.style.display = "none";
  });

  window.addEventListener("click", (event) => {
    if (event.target === modal) {
      modal.style.display = "none";
    }
  });

  function createRequestChargeClient() {
    console.log("clicked");
    // Get the CSRF token from the cookie
    var csrftoken = getCookie('csrftoken');

    // Prepare the data to be sent
    var formData = new FormData();
    formData.append('client_id', '{{ original.pk }}');
    // Add other form data as needed

    // Create a hidden form to submit the data
    var hiddenForm = document.createElement('form');
    hiddenForm.method = 'POST';
    hiddenForm.action = '/api/client/admin-requests/';
    hiddenForm.style.display = 'none';

    // Attach the CSRF token as a form field
    var csrfInput = document.createElement('input');
    csrfInput.type = 'hidden';
    csrfInput.name = 'csrfmiddlewaretoken';
    csrfInput.value = csrftoken;
    hiddenForm.appendChild(csrfInput);

    // Append form data to the hidden form
    for (var pair of formData.entries()) {
      var input = document.createElement('input');
      input.type = 'hidden';
      input.name = pair[0];
      input.value = pair[1];
      hiddenForm.appendChild(input);
    }

    // Append the hidden form to the document and submit it
    document.body.appendChild(hiddenForm);
    hiddenForm.submit();
  }

  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        // Does this cookie string begin with the name we want?
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
</script>

{% endblock %}

{% block extrastyle %}
<style>
  .object-tools {
    display: flex !important;
    justify-content: flex-end;
  }

  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 9999; /* Adjust the z-index as needed */
  }

  .modal-content {
    background-color: #fff;
    width: 50%;
    margin: 20% auto;
    padding: 20px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    text-align: center;
    z-index: 10;
  }

  .modal-button {
    padding: 10px 20px;
    background-color: #007bff;
    color: #fff;
    border: none;
    cursor: pointer;
  }

  .close {
    float: right;
    font-weight: bold;
    cursor: pointer;
  }

  {{ block.super }}
</style>

<div id="myModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeModalBtn">&times;</span>
    <h2>Confirmation</h2>
    <p>Are you sure you want to charge the client?</p>
    <button type="button" class="modal-button" onclick="createRequestChargeClient()">Confirm</button>
  </div>
</div>

{{ block.super }}
{% endblock %}

{% block object-tools-items %}
<div>
  <button type="button" id="openModalBtn" onclick="openModal()">Charge client</button>
</div>
{{ block.super }}
{% endblock %}
